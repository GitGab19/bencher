version: "3.9"
services:

  nginx:
    build:
      context: ./services/local/nginx
      dockerfile: Dockerfile
    restart: always
    ports:
      - 80:80
    depends_on:
      # - cli 
      - ui
      - fn_admin
      - fn_reports

  ui:
    build:
      context: ./services/ui
      dockerfile: dev.Dockerfile
    volumes:
      - "./services/ui:/usr/src/ui"
      - "/usr/src/ui/node_modules"
    ports:
      - 6000:3000
    depends_on:
      - fn_admin
      - fn_reports

  # cli:
  #   build:
  #     context: ./services
  #     dockerfile: ./cli/Dockerfile
  #   image: bencher-cli
  #   container_name: bencher_cli

  postgres:
    build:
      context: ./services/local/db
      dockerfile: Dockerfile
    image: bencher-postgres
    container_name: bencher_postgres
    ports:
      - 5432:5432
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=postgres

  fn_admin:
    build:
      context: ./services
      dockerfile: ./api/admin/dev.Dockerfile
    image: fn-admin
    container_name: fn_admin
    ports:
        - 2000:8080
    environment:
      - DATABASE_URL=postgres://postgres:postgres@postgres:5432/bencher
    depends_on:
      - postgres

  fn_reports:
    build:
      context: ./services
      dockerfile: ./api/reports/dev.Dockerfile
    image: fn-reports
    container_name: fn_reports
    ports:
        - 2001:8080
    environment:
      - DATABASE_URL=postgres://postgres:postgres@postgres:5432/bencher
    depends_on:
      - postgres
      - fn_admin

  swagger:
    build:
      context: ./services
      dockerfile: ./api/swagger/Dockerfile
    ports:
      - 2999:8080