import { BENCHER_VERSION } from "../../../site/util";

<pre>
  <code>
    {`benchmark_with_bencher:
    name: Run benchmarks with Bencher
    runs-on: ubuntu-latest
    env:
      BENCHER_PROJECT: save-walter-white
      BENCHER_TESTBED: ubuntu-latest
      BENCHER_ADAPTER: rust
      BENCHER_API_TOKEN: \${{ secrets.BENCHER_API_TOKEN }}
      BENCHER_VERSION: ${BENCHER_VERSION}
    steps:
      - uses: actions/checkout@v3
      - name: Install Bencher CLI
        run: |
          wget https://github.com/bencherdev/bencher/releases/download/v\${BENCHER_VERSION}/bencher_\${BENCHER_VERSION}_amd64.deb
          sudo dpkg -i bencher_\${BENCHER_VERSION}_amd64.deb
      - name: Benchmark with Bencher
        run: bencher run \\
        --if-branch $GITHUB_REF_NAME \\
        --else-if-branch $GITHUB_BASE_REF \\
        --else-if-branch main \\
        --else-branch \\
        --err \\
        "bencher mock"`}
  </code>
</pre>

1. Create a GitHub Actions `job` (ex: `benchmark_with_bencher`)
2. The Bencher project must already exist. Set the `--project` flag or the `BENCHER_PROJECT` environment variable to the project slug or UUID. (ex: `BENCHER_PROJECT: save-walter-white`)
3. There are several options for setting the project branch. See [branch selection](/docs/how-to/cli-branch-selection) for a full overview.

> The provided command uses [GitHub Action default environment variables](https://docs.github.com/en/actions/learn-github-actions/variables#default-environment-variables) and it tries to:
> 1. Use the current branch data if it exists in Bencher already (ex: `--if-branch $GITHUB_REF_NAME`)
> 1. Create a clone of PR target branch data and thresholds if it exists in Bencher already (ex: `--else-if-branch $GITHUB_BASE_REF`)
> 1. Create a clone of the `main` branch data and thresholds if it exists in Bencher already. `main` exists by default in all projects. (ex: `--else-if-branch main`)
> 1. Create a new branch with the name provided by `--if-branch $CI_COMMIT_REF_NAME` (ex: `--else-branch`)

4. The project testbed must already exist. Set the `--testbed` flag or the `BENCHER_TESTBED` environment variable to the testbed slug or UUID. (ex: `BENCHER_TESTBED: ubuntu-latest`)
5. Optional: Set the `--adapter` flag or the `BENCHER_ADAPTER` environment variable to the desired adapter name. If this is not set, then the `magic` adapter will be used. See [benchmark harness adapters](/docs/explanation/adapters) for a full overview. (ex: `BENCHER_ADAPTER: rust`)
6. Add `BENCHER_API_TOKEN` to you **Repository** secrets (ex: `https://github.com/USERNAME/REPO/settings/secrets/actions`)
7. The API token must already exist. Set the `--token` flag or the `BENCHER_API_TOKEN` environment variable to the API token. (ex: `BENCHER_API_TOKEN: ${{ secrets.BENCHER_API_TOKEN }}`)
8. Optional: Create an environment variable to make it easy to keep track the CLI version being used (ex: <code>{`BENCHER_VERSION: ${BENCHER_VERSION}`}</code>)
9. Checkout your source code (ex: `uses: actions/checkout@v3`)
10. Install the Bencher CLI from a `.deb`
11. Run your benchmarks (ex: `bencher mock`) with the `bencher run` command (ex: `bencher run "bencher mock"`)
12. Set the `--err` flag to fail on an alert (ex: `bencher run --err "bencher mock"`)
